# ìŒì„±ì¸ì‹ ì‹œìŠ¤í…œ í†µí•© ì•„í‚¤í…ì²˜ ë¬¸ì„œ

**í”„ë¡œì íŠ¸**: M5Stack Core S3 ì¥ë¹„ ì›ê²© ê´€ë¦¬ ì‹œìŠ¤í…œ  
**ë²„ì „**: 1.0.0  
**ì‘ì„±ì¼**: 2025-12-08  
**ì‘ì„±ì**: AI Assistant

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°](#ì»´í¬ë„ŒíŠ¸-êµ¬ì¡°)
4. [ë°ì´í„° í”Œë¡œìš°](#ë°ì´í„°-í”Œë¡œìš°)
5. [í†µì‹  í”„ë¡œí† ì½œ](#í†µì‹ -í”„ë¡œí† ì½œ)
6. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)

---

## ğŸ¯ ê°œìš”

### ëª©ì 

CoreS3 ì¥ë¹„ì—ì„œ ì‹¤ì‹œê°„ ìŒì„±ì„ ì¸ì‹í•˜ê³ , ì¸ì‹ ê²°ê³¼ë¥¼ ì›¹ í”„ë¡ íŠ¸ì—”ë“œì— í‘œì‹œí•˜ëŠ” í†µí•© ì‹œìŠ¤í…œ êµ¬ì¶•.

### ì£¼ìš” ê¸°ëŠ¥

- âœ… **ì‹¤ì‹œê°„ ìŒì„±ì¸ì‹**: CoreS3 ë§ˆì´í¬ â†’ ASR ì„œë²„ â†’ í…ìŠ¤íŠ¸ ë³€í™˜
- âœ… **ê²°ê³¼ í‘œì‹œ**:
  - CoreS3 ë””ìŠ¤í”Œë ˆì´ì— ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ í‘œì‹œ
  - ì›¹ í”„ë¡ íŠ¸ì—”ë“œ ì±„íŒ… ì°½ì— íˆìŠ¤í† ë¦¬ í‘œì‹œ
- âœ… **ì‘ê¸‰ ìƒí™© ê°ì§€**: íŠ¹ì • í‚¤ì›Œë“œ ê°ì§€ ì‹œ ìë™ ì•Œë¦¼
- âœ… **ë‹¤ì¤‘ ì„¸ì…˜**: ì—¬ëŸ¬ ì¥ë¹„ ë™ì‹œ ìŒì„±ì¸ì‹ ì§€ì›

### ê¸°ìˆ  ìŠ¤íƒ

| ê³„ì¸µ           | ê¸°ìˆ                      | ìš©ë„                   |
| -------------- | ------------------------ | ---------------------- |
| **ìŒì„±ì¸ì‹**   | Sherpa-ONNX (RK3588 NPU) | ì˜¤í”„ë¼ì¸ ìŒì„±ì¸ì‹ ì—”ì§„ |
| **ASR ì„œë²„**   | FastAPI + WebSocket      | ìŒì„±ì¸ì‹ API ì„œë²„      |
| **ë°±ì—”ë“œ**     | FastAPI + MQTT           | ì¥ë¹„ ê´€ë¦¬ ë° ì¤‘ê³„      |
| **íŒì›¨ì–´**     | Arduino (ESP32)          | CoreS3 ì œì–´            |
| **í”„ë¡ íŠ¸ì—”ë“œ** | Next.js + React          | ì›¹ UI                  |
| **í†µì‹ **       | WebSocket, MQTT, HTTP    | ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹      |

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ìŒì„±ì¸ì‹ í†µí•© ì‹œìŠ¤í…œ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CoreS3     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   FastAPI    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  ASR Server  â”‚
â”‚   Firmware   â”‚  MQTT   â”‚   Backend    â”‚  HTTP   â”‚ (Sherpa-ONNX)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â”‚ WebSocket              â”‚ WebSocket              â”‚ VAD + STT
       â”‚ (Audio)                â”‚ (Monitor)              â”‚
       â”‚                        â”‚                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Next.js     â”‚
                        â”‚  Frontend    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

```
[CoreS3] 192.168.x.x
    â”‚
    â”œâ”€ MQTT (port 1883) â”€â”€â”€â”€â”€â”€> [FastAPI Backend] localhost:8000
    â”‚
    â””â”€ WebSocket (port 8001) â”€â”€> [ASR Server] 192.168.x.x:8001
                                      â”‚
                                      â””â”€ HTTP (port 8000) <â”€â”€ [FastAPI Backend]

[Frontend] localhost:3000
    â”‚
    â”œâ”€ HTTP API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [FastAPI Backend] localhost:8000
    â”‚
    â””â”€ WebSocket (Monitor) â”€â”€â”€â”€> [FastAPI Backend] localhost:8000
```

---

## ğŸ”§ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

### 1. ASR Server (ìŒì„±ì¸ì‹ ì„œë²„)

**ìœ„ì¹˜**: `backend/rk3588asr/asr_api_server.py`

**ì±…ì„**:

- WebSocketìœ¼ë¡œ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ìˆ˜ì‹ 
- VAD (Voice Activity Detection)ë¡œ ìŒì„± êµ¬ê°„ ê°ì§€
- Sherpa-ONNXë¡œ ìŒì„± â†’ í…ìŠ¤íŠ¸ ë³€í™˜
- ì¸ì‹ ê²°ê³¼ WebSocketìœ¼ë¡œ ì „ì†¡
- ì„¸ì…˜ ê´€ë¦¬ (ë‹¤ì¤‘ í´ë¼ì´ì–¸íŠ¸)

**ì£¼ìš” í´ë˜ìŠ¤**:

```python
SessionManager      # ì „ì—­ ì„¸ì…˜ ê´€ë¦¬ì (ì‹±ê¸€í†¤)
â”œâ”€ ASRSession       # ê°œë³„ ìŒì„±ì¸ì‹ ì„¸ì…˜
   â””â”€ VADStreamingProcessor  # VAD + ìŒì„±ì¸ì‹ í”„ë¡œì„¸ì„œ
```

**ì˜ì¡´ì„±**:

- Sherpa-ONNX: RK3588 NPU ìµœì í™” ìŒì„±ì¸ì‹
- FastAPI: REST API + WebSocket ì„œë²„
- demo_vad_final.py: VAD ë¡œì§ ì¬ì‚¬ìš©

---

### 2. FastAPI Backend (ë°±ì—”ë“œ API ì„œë²„)

**ìœ„ì¹˜**: `backend/app/`

**ì±…ì„**:

- CoreS3 ì¥ë¹„ ê´€ë¦¬ (CRUD)
- MQTT ë¸Œë¡œì»¤ì™€ í†µì‹  (ì¥ë¹„ ì œì–´)
- ASR ì„œë²„ í”„ë¡ì‹œ (ì„¸ì…˜ ìƒì„±/ì¢…ë£Œ)
- í”„ë¡ íŠ¸ì—”ë“œì— ì¸ì‹ ê²°ê³¼ ì¤‘ê³„ (WebSocket)
- ì¸ì¦/ê¶Œí•œ ê´€ë¦¬

**ì¶”ê°€ë  ëª¨ë“ˆ**:

```
backend/app/
â”œâ”€ services/
â”‚  â””â”€ asr_service.py       # ASR ì„œë²„ í´ë¼ì´ì–¸íŠ¸
â”œâ”€ api/
â”‚  â””â”€ asr.py               # ASR API ë¼ìš°í„°
â””â”€ schemas/
   â””â”€ asr.py               # ASR ë°ì´í„° ìŠ¤í‚¤ë§ˆ
```

**ë°ì´í„°ë² ì´ìŠ¤**:

- Device: ì¥ë¹„ ì •ë³´
- DeviceStatus: ì¥ë¹„ ìƒíƒœ (ì‹¤ì‹œê°„)
- ASRSession (ì˜ˆì •): ìŒì„±ì¸ì‹ ì„¸ì…˜ ë¡œê·¸

---

### 3. CoreS3 Firmware (ì¥ë¹„ íŒì›¨ì–´)

**ìœ„ì¹˜**: `firmware/src/`

**ì±…ì„**:

- I2S ë§ˆì´í¬ë¡œ ì˜¤ë””ì˜¤ ìº¡ì²˜ (16kHz PCM)
- WebSocket í´ë¼ì´ì–¸íŠ¸ë¡œ ì˜¤ë””ì˜¤ ì „ì†¡
- ì¸ì‹ ê²°ê³¼ ìˆ˜ì‹  ë° ë””ìŠ¤í”Œë ˆì´ í‘œì‹œ
- MQTTë¡œ ì¥ë¹„ ìƒíƒœ ë° ëª…ë ¹ í†µì‹ 

**ì¶”ê°€ë  ëª¨ë“ˆ**:

```
firmware/
â”œâ”€ include/
â”‚  â””â”€ websocket_module.h   # WebSocket í—¤ë”
â””â”€ src/
   â”œâ”€ websocket_module.cpp # WebSocket êµ¬í˜„
   â”œâ”€ audio_module.cpp     # I2S â†’ WebSocket ìŠ¤íŠ¸ë¦¬ë°
   â””â”€ mqtt_module.cpp      # start_asr ëª…ë ¹ ì²˜ë¦¬
```

**ë¼ì´ë¸ŒëŸ¬ë¦¬**:

- ArduinoWebsockets: WebSocket í´ë¼ì´ì–¸íŠ¸
- ArduinoJson: JSON ì§ë ¬í™”
- I2S Driver: ë§ˆì´í¬ ì…ë ¥

---

### 4. Next.js Frontend (ì›¹ í”„ë¡ íŠ¸ì—”ë“œ)

**ìœ„ì¹˜**: `frontend/src/`

**ì±…ì„**:

- ì¥ë¹„ ê´€ë¦¬ UI (ëª©ë¡, ìƒì„¸)
- ìŒì„±ì¸ì‹ í…ŒìŠ¤íŠ¸ íŒ¨ë„
- ì±„íŒ… ì°½ (ì¸ì‹ ê²°ê³¼ íˆìŠ¤í† ë¦¬)
- WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ 

**ì¶”ê°€ë  ì»´í¬ë„ŒíŠ¸**:

```
frontend/src/
â”œâ”€ components/
â”‚  â”œâ”€ VoiceRecognitionPanel.tsx  # ìŒì„±ì¸ì‹ íŒ¨ë„
â”‚  â””â”€ RecognitionChatWindow.tsx  # ì±„íŒ… UI
â”œâ”€ hooks/
â”‚  â””â”€ useASRWebSocket.ts         # WebSocket Hook
â””â”€ lib/
   â””â”€ api.ts                      # ASR API ì¶”ê°€
```

---

## ğŸ”„ ë°ì´í„° í”Œë¡œìš°

### ì‹œë‚˜ë¦¬ì˜¤ 1: ìŒì„±ì¸ì‹ ì‹œì‘

```
[ì‚¬ìš©ì] ì›¹ì—ì„œ "ì‹œì‘" ë²„íŠ¼ í´ë¦­
    â”‚
    â”œâ”€ â‘  POST /asr/devices/{id}/session/start
    â”‚     â”‚
    â”‚     â”œâ”€ [Backend] ASR ì„œë²„ì— ì„¸ì…˜ ìƒì„± ìš”ì²­
    â”‚     â”‚     â”‚
    â”‚     â”‚     â””â”€ POST http://192.168.x.x:8001/asr/session/start
    â”‚     â”‚           {device_id, language, sample_rate}
    â”‚     â”‚
    â”‚     â”œâ”€ [ASR Server] ì„¸ì…˜ ìƒì„±
    â”‚     â”‚     â”‚
    â”‚     â”‚     â”œâ”€ UUID ìƒì„± (session_id)
    â”‚     â”‚     â”œâ”€ VADStreamingProcessor ì´ˆê¸°í™”
    â”‚     â”‚     â””â”€ ì‘ë‹µ: {session_id, ws_url}
    â”‚     â”‚
    â”‚     â””â”€ [Backend] MQTTë¡œ CoreS3ì— ëª…ë ¹ ì „ì†¡
    â”‚           TOPIC: devices/{device_id}/control/microphone
    â”‚           PAYLOAD: {
    â”‚             command: "microphone",
    â”‚             action: "start_asr",
    â”‚             session_id: "...",
    â”‚             ws_url: "ws://..."
    â”‚           }
    â”‚
    â””â”€ â‘¡ [CoreS3] MQTT ìˆ˜ì‹ 
          â”‚
          â”œâ”€ WebSocket ì—°ê²°: ws://192.168.x.x:8001/ws/asr/{session_id}
          â”œâ”€ I2S ë§ˆì´í¬ ì‹œì‘
          â””â”€ ë””ìŠ¤í”Œë ˆì´ì— "ìŒì„±ì¸ì‹ ì‹œì‘" í‘œì‹œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì‹¤ì‹œê°„ ìŒì„± ì „ì†¡ ë° ì¸ì‹

```
[CoreS3] I2S ë§ˆì´í¬ ë£¨í”„
    â”‚
    â”œâ”€ â‘  I2Sì—ì„œ ì˜¤ë””ì˜¤ ì½ê¸° (1024 samples, 16kHz, int16)
    â”‚     size_t bytesRead;
    â”‚     i2s_read(I2S_PORT_IN, audioBuffer, 2048, &bytesRead, portMAX_DELAY);
    â”‚
    â”œâ”€ â‘¡ int16 â†’ float32 ë³€í™˜
    â”‚     float32 = int16 / 32768.0
    â”‚
    â”œâ”€ â‘¢ Base64 ì¸ì½”ë”©
    â”‚     String base64 = base64::encode(audioBytes);
    â”‚
    â”œâ”€ â‘£ JSON ë©”ì‹œì§€ ìƒì„±
    â”‚     {
    â”‚       "type": "audio_chunk",
    â”‚       "data": "base64_string",
    â”‚       "timestamp": millis()
    â”‚     }
    â”‚
    â””â”€ â‘¤ WebSocket ì „ì†¡
          ws.send(json);

          â”‚
          â–¼
    [ASR Server] WebSocket ìˆ˜ì‹ 
          â”‚
          â”œâ”€ â‘  Base64 ë””ì½”ë”©
          â”‚     bytes = base64.b64decode(data)
          â”‚
          â”œâ”€ â‘¡ bytes â†’ numpy array
          â”‚     audio_int16 = np.frombuffer(bytes, dtype=np.int16)
          â”‚     audio_float32 = audio_int16.astype(np.float32) / 32768.0
          â”‚
          â”œâ”€ â‘¢ VAD ì²˜ë¦¬
          â”‚     result = vad_processor.process_audio_chunk(audio_float32)
          â”‚     â”‚
          â”‚     â”œâ”€ ì—ë„ˆì§€ ê³„ì‚° (RMS)
          â”‚     â”œâ”€ ìŒì„±/ì¹¨ë¬µ íŒë‹¨
          â”‚     â”œâ”€ ë²„í¼ ëˆ„ì 
          â”‚     â””â”€ ì¹¨ë¬µ ê°ì§€ ì‹œ â†’ ìŒì„±ì¸ì‹ ìˆ˜í–‰
          â”‚
          â”œâ”€ â‘£ ìŒì„±ì¸ì‹
          â”‚     stream = recognizer.create_stream()
          â”‚     stream.accept_waveform(16000, audio_data)
          â”‚     recognizer.decode_stream(stream)
          â”‚     text = stream.result.text
          â”‚
          â”œâ”€ â‘¤ ì‘ê¸‰ ìƒí™© ê°ì§€
          â”‚     if "ë„ì™€ì¤˜" in text or "119" in text:
          â”‚         send_emergency_alert(text)
          â”‚
          â””â”€ â‘¥ WebSocket ì‘ë‹µ
                {
                  "type": "recognition_result",
                  "text": "ì¸ì‹ëœ í…ìŠ¤íŠ¸",
                  "timestamp": "2025-12-08 10:30:45",
                  "is_emergency": false
                }

                â”‚
                â”œâ”€â”€> [CoreS3] ìˆ˜ì‹ 
                â”‚      â””â”€ displayShowText(text)
                â”‚
                â””â”€â”€> [Backend] ì¤‘ê³„ â†’ [Frontend]
                       â””â”€ ì±„íŒ… ì°½ì— í‘œì‹œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ìŒì„±ì¸ì‹ ì¢…ë£Œ

```
[ì‚¬ìš©ì] ì›¹ì—ì„œ "ì •ì§€" ë²„íŠ¼ í´ë¦­
    â”‚
    â”œâ”€ POST /asr/devices/{id}/session/stop
    â”‚     â”‚
    â”‚     â”œâ”€ [Backend] MQTTë¡œ CoreS3ì— ëª…ë ¹
    â”‚     â”‚     TOPIC: devices/{device_id}/control/microphone
    â”‚     â”‚     PAYLOAD: {action: "stop_asr"}
    â”‚     â”‚
    â”‚     â””â”€ [Backend] ASR ì„œë²„ì— ì„¸ì…˜ ì¢…ë£Œ ìš”ì²­
    â”‚           POST http://192.168.x.x:8001/asr/session/{session_id}/stop
    â”‚
    â”œâ”€ [CoreS3] MQTT ìˆ˜ì‹ 
    â”‚     â”‚
    â”‚     â”œâ”€ WebSocket ì—°ê²° ì¢…ë£Œ
    â”‚     â”œâ”€ I2S ë§ˆì´í¬ ì •ì§€
    â”‚     â””â”€ ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
    â”‚
    â””â”€ [ASR Server] ì„¸ì…˜ ì •ë¦¬
          â”‚
          â”œâ”€ VAD Processor ì¢…ë£Œ
          â”œâ”€ ì„¸ì…˜ ëª©ë¡ì—ì„œ ì œê±°
          â””â”€ ë¦¬ì†ŒìŠ¤ í•´ì œ
```

---

## ğŸ”Œ í†µì‹  í”„ë¡œí† ì½œ

### 1. MQTT (CoreS3 â†” Backend)

**í† í”½ êµ¬ì¡°**:

```
devices/{device_id}/control/microphone    # ë§ˆì´í¬ ì œì–´ ëª…ë ¹
devices/{device_id}/status                # ì¥ë¹„ ìƒíƒœ ë³´ê³ 
devices/{device_id}/response              # ëª…ë ¹ ì‘ë‹µ
```

**start_asr ëª…ë ¹**:

```json
{
  "command": "microphone",
  "action": "start_asr",
  "session_id": "uuid-xxxx",
  "ws_url": "ws://192.168.x.x:8001/ws/asr/uuid-xxxx",
  "language": "auto",
  "request_id": "req-123"
}
```

**stop_asr ëª…ë ¹**:

```json
{
  "command": "microphone",
  "action": "stop_asr",
  "request_id": "req-456"
}
```

---

### 2. WebSocket (CoreS3 â†” ASR Server)

**URL**: `ws://192.168.x.x:8001/ws/asr/{session_id}`

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„**:

| íƒ€ì…          | ì„¤ëª…          | í˜ì´ë¡œë“œ                  |
| ------------- | ------------- | ------------------------- |
| `audio_chunk` | ì˜¤ë””ì˜¤ ë°ì´í„° | `{type, data, timestamp}` |
| `ping`        | ì—°ê²° ìœ ì§€     | `{type}`                  |

**ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸**:

| íƒ€ì…                 | ì„¤ëª…      | í˜ì´ë¡œë“œ                                          |
| -------------------- | --------- | ------------------------------------------------- |
| `connected`          | ì—°ê²° í™•ì¸ | `{type, session_id, message}`                     |
| `recognition_result` | ì¸ì‹ ê²°ê³¼ | `{type, text, timestamp, duration, is_emergency}` |
| `processing`         | ì²˜ë¦¬ ì¤‘   | `{type, message}`                                 |
| `error`              | ì˜¤ë¥˜      | `{type, message}`                                 |
| `pong`               | Ping ì‘ë‹µ | `{type, session_id}`                              |

---

### 3. HTTP REST API (Backend â†” ASR Server)

**ASR ì„œë²„ API**:

| Method | Endpoint                   | ì„¤ëª…      |
| ------ | -------------------------- | --------- |
| POST   | `/asr/session/start`       | ì„¸ì…˜ ìƒì„± |
| GET    | `/asr/session/{id}/status` | ì„¸ì…˜ ìƒíƒœ |
| POST   | `/asr/session/{id}/stop`   | ì„¸ì…˜ ì¢…ë£Œ |
| GET    | `/asr/sessions`            | ì„¸ì…˜ ëª©ë¡ |

**ë°±ì—”ë“œ API (í”„ë¡ íŠ¸ì—”ë“œìš©)**:

| Method | Endpoint                           | ì„¤ëª…               |
| ------ | ---------------------------------- | ------------------ |
| POST   | `/asr/devices/{id}/session/start`  | ì¥ë¹„ ìŒì„±ì¸ì‹ ì‹œì‘ |
| POST   | `/asr/devices/{id}/session/stop`   | ì¥ë¹„ ìŒì„±ì¸ì‹ ì¢…ë£Œ |
| GET    | `/asr/devices/{id}/session/status` | ì„¸ì…˜ ìƒíƒœ ì¡°íšŒ     |
| WS     | `/ws/asr/monitor/{device_id}`      | ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§    |

---

### 4. WebSocket (Frontend â†” Backend)

**URL**: `ws://localhost:8000/ws/asr/monitor/{device_id}`

**ìš©ë„**: í”„ë¡ íŠ¸ì—”ë“œê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¸ì‹ ê²°ê³¼ë¥¼ ëª¨ë‹ˆí„°ë§

**ë©”ì‹œì§€**:

```json
{
  "type": "recognition_result",
  "device_id": "cores3_01",
  "session_id": "uuid-xxxx",
  "text": "ì•ˆë…•í•˜ì„¸ìš”",
  "timestamp": "2025-12-08 10:30:45",
  "is_emergency": false
}
```

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì¸ì¦ ë° ê¶Œí•œ

- **JWT í† í°**: API ìš”ì²­ ì‹œ Bearer í† í° í•„ìš”
- **ì„¸ì…˜ ê²€ì¦**: WebSocket ì—°ê²° ì‹œ session_id ê²€ì¦
- **ì¥ë¹„ ì†Œìœ ê¶Œ**: ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì¥ë¹„ë§Œ ì œì–´ ê°€ëŠ¥

### 2. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

- **HTTPS/WSS**: í”„ë¡œë•ì…˜ì—ì„œëŠ” SSL ì¸ì¦ì„œ ì‚¬ìš©
- **CORS ì„¤ì •**: í—ˆìš©ëœ ë„ë©”ì¸ë§Œ API ì ‘ê·¼ ê°€ëŠ¥
- **Rate Limiting**: API ìš”ì²­ ë¹ˆë„ ì œí•œ

### 3. ë°ì´í„° ë³´ì•ˆ

- **ì˜¤ë””ì˜¤ ë°ì´í„°**: ì „ì†¡ í›„ ì¦‰ì‹œ ì‚­ì œ (ì €ì¥í•˜ì§€ ì•ŠìŒ)
- **ì¸ì‹ ê²°ê³¼**: í•„ìš”ì‹œ ì•”í˜¸í™” ì €ì¥
- **ì‘ê¸‰ ì•Œë¦¼**: ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹

### 4. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬

- **ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ**: 30ë¶„ ì´ìƒ ë¹„í™œì„± ì‹œ ìë™ ì¢…ë£Œ
- **ìµœëŒ€ ì„¸ì…˜ ìˆ˜**: ë™ì‹œ 10ê°œ ì„¸ì…˜ ì œí•œ
- **ë©”ëª¨ë¦¬ ì œí•œ**: ì„¸ì…˜ë‹¹ ìµœëŒ€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œí•œ

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### ASR ì„œë²„ (RK3588)

```bash
# NPU 4ì½”ì–´ ëª¨ë‘ ì‚¬ìš©
taskset 0x0F python asr_api_server.py
```

### WebSocket ë²„í¼ë§

- ì˜¤ë””ì˜¤ ì²­í¬ í¬ê¸°: 1024 samples (64ms @ 16kHz)
- WebSocket ì „ì†¡ ì£¼ê¸°: ì‹¤ì‹œê°„ (ë²„í¼ë§ ìµœì†Œí™”)
- Base64 ì˜¤ë²„í—¤ë“œ: ~33% (ê³ ë ¤ í•„ìš”)

### ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

- ì¸ë±ìŠ¤: device_id, session_id, timestamp
- ì˜¤ë˜ëœ ì„¸ì…˜ ë¡œê·¸ ìë™ ì‚­ì œ (7ì¼ ì´ìƒ)

---

## ğŸ“ˆ í™•ì¥ ê°€ëŠ¥ì„±

### ë‹¤êµ­ì–´ ì§€ì›

- í˜„ì¬: í•œêµ­ì–´, ì˜ì–´, ì¤‘êµ­ì–´, ì¼ë³¸ì–´, ê´‘ë™ì–´
- ì¶”ê°€ ê°€ëŠ¥: ê¸°íƒ€ ì–¸ì–´ ëª¨ë¸ êµì²´

### ë‹¤ì¤‘ ASR ì—”ì§„

- Sherpa-ONNX (í˜„ì¬)
- Google Speech-to-Text (í´ë¼ìš°ë“œ)
- Whisper (OpenAI)

### ì˜¤ë””ì˜¤ ì²˜ë¦¬ ê³ ë„í™”

- ë…¸ì´ì¦ˆ ì œê±°
- ìŒëŸ‰ ìë™ ì¡°ì ˆ (AGC)
- ì—ì½” ì œê±° (AEC)

---

## ğŸ”— ì°¸ê³  ìë£Œ

- [Sherpa-ONNX ë¬¸ì„œ](https://k2-fsa.github.io/sherpa/onnx/)
- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com/)
- [WebSocket í”„ë¡œí† ì½œ](https://datatracker.ietf.org/doc/html/rfc6455)
- [MQTT í”„ë¡œí† ì½œ](https://mqtt.org/)

---

**ë¬¸ì„œ ë²„ì „**: 1.0.0  
**ìµœì¢… ìˆ˜ì •**: 2025-12-08  
**ìƒíƒœ**: Phase 1 ì™„ë£Œ, Phase 2-4 ì§„í–‰ ì¤‘
