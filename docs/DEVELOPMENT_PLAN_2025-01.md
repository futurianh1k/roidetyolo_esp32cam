# 후속 개발 계획 (2025-01)

## 1. 현재 상태 분석

### 1.1 대시보드 페이지 (`/dashboard`)

| 기능               | 상태           | 설명                                                 |
| ------------------ | -------------- | ---------------------------------------------------- |
| 장비 목록 조회     | ✅ 동작        | 10초마다 자동 갱신                                   |
| 장비 등록          | ✅ 동작        | RegisterDeviceModal                                  |
| 장비 삭제          | ✅ 동작        | DeleteDeviceModal                                    |
| 통계 표시          | ⚠️ 부분        | 온라인/오프라인 카운트만                             |
| ASR 통계 차트      | ⚠️ 미구현      | ASRStatsChart 컴포넌트 있음, 백엔드 API 필요         |
| 응급 알림 히스토리 | ⚠️ 미구현      | EmergencyAlertHistory 컴포넌트 있음, 백엔드 API 필요 |
| 로그인 인증        | 🔴 비활성화    | TODO 주석으로 비활성화됨                             |
| 사용자 정보        | 🔴 더미 데이터 | 하드코딩된 guest 사용자                              |

### 1.2 장비 상세 페이지 (`/devices/[id]`)

| 기능               | 상태      | 설명                                     |
| ------------------ | --------- | ---------------------------------------- |
| 장비 정보 조회     | ✅ 동작   | 기본 정보 표시                           |
| IP 주소 편집       | ✅ 동작   | 인라인 편집                              |
| 카메라 제어        | ⚠️ 부분   | API 호출 가능, 장비 응답 미확인          |
| 마이크 제어        | ⚠️ 부분   | API 호출 가능, WebSocket 설정 가능       |
| 스피커 제어        | ⚠️ 부분   | 파일 업로드/재생 가능, 장비 응답 미확인  |
| 디스플레이 제어    | ⚠️ 부분   | 텍스트/이모지 표시 가능                  |
| 비디오 스트림      | 🔴 미구현 | VideoPlayer 컴포넌트 있음, 스트림 미연결 |
| 음성인식 패널      | ⚠️ 부분   | 세션 시작/종료 가능, ASR 서버 연동 필요  |
| 장비 상태 모니터링 | ⚠️ 부분   | API 호출 가능, 장비 상태 전송 필요       |
| 장비 재시작        | ⚠️ 미확인 | API 호출 가능, 장비 응답 미확인          |
| 장비 삭제          | ✅ 동작   | 확인 후 삭제                             |

### 1.3 백엔드 API 현황

| API 엔드포인트 | 상태      | 설명                  |
| -------------- | --------- | --------------------- |
| `/auth/*`      | ⚠️ 구현됨 | 인증 비활성화 상태    |
| `/devices/*`   | ✅ 동작   | CRUD 동작 중          |
| `/control/*`   | ⚠️ 부분   | MQTT 연동 필요        |
| `/audio/*`     | ⚠️ 부분   | 파일 업로드/목록 동작 |
| `/asr/*`       | ⚠️ 부분   | ASR 서버 연동 필요    |
| `/ws/*`        | ⚠️ 부분   | WebSocket 연결 가능   |

---

## 2. 우선순위별 개발 계획

### Phase 1: 기본 기능 안정화 (1주)

1. **백엔드 인증 활성화**

   - `devices.py`의 TODO 주석 제거
   - 프론트엔드 로그인 연동 활성화
   - 토큰 갱신 로직 구현

2. **장비 상태 모니터링 완성**

   - 펌웨어에서 주기적 상태 전송 구현
   - 백엔드 MQTT 수신 및 DB 저장
   - 프론트엔드 실시간 업데이트

3. **E2E 테스트 기본 구축**
   - Selenium 테스트 환경 설정
   - 로그인/대시보드 기본 테스트

### Phase 2: 장비 제어 기능 (2주)

1. **카메라 스트리밍**

   - MJPEG 스트림 구현 (펌웨어)
   - VideoPlayer 컴포넌트 연동
   - HTTP 기반 이미지 수신

2. **MQTT 제어 명령 안정화**

   - 카메라 시작/정지 확인
   - 마이크 시작/정지 확인
   - 디스플레이 텍스트 표시 확인

3. **오디오 재생**
   - 펌웨어 오디오 다운로드 구현
   - 백엔드 오디오 URL 생성
   - 재생 상태 피드백

### Phase 3: 음성인식 통합 (2주)

1. **ASR 서버 연동**

   - WebSocket 오디오 스트리밍
   - 실시간 인식 결과 수신
   - 응급 상황 감지 알림

2. **인식 결과 관리**

   - 결과 DB 저장
   - 히스토리 조회 API
   - 통계 대시보드

3. **응급 알림 시스템**
   - 푸시 알림 (선택사항)
   - 이메일 알림 (선택사항)
   - 응급 히스토리 표시

### Phase 4: 고급 기능 (2주)

1. **OTA 펌웨어 업데이트**

   - 펌웨어 업로드 API
   - 버전 관리
   - 롤백 기능

2. **다중 장비 관리**

   - 그룹별 장비 관리
   - 일괄 제어 기능
   - 장비 비교 뷰

3. **보안 강화**
   - 프론트엔드 토큰 보안 개선 (HttpOnly 쿠키)
   - 펌웨어 민감정보 NVS 이동
   - 감사 로그 조회 UI

---

## 3. E2E 테스트 시나리오

### 3.1 인증 시나리오

- TC-AUTH-001: 로그인 성공
- TC-AUTH-002: 로그인 실패 (잘못된 비밀번호)
- TC-AUTH-003: 로그아웃
- TC-AUTH-004: 토큰 만료 시 자동 갱신

### 3.2 대시보드 시나리오

- TC-DASH-001: 대시보드 로드 및 통계 확인
- TC-DASH-002: 장비 목록 표시
- TC-DASH-003: 장비 등록 모달
- TC-DASH-004: 장비 삭제 모달
- TC-DASH-005: 새로고침 버튼

### 3.3 장비 상세 시나리오

- TC-DEV-001: 장비 상세 페이지 로드
- TC-DEV-002: IP 주소 편집
- TC-DEV-003: 카메라 제어 (시작/정지)
- TC-DEV-004: 디스플레이 텍스트 표시
- TC-DEV-005: 음성인식 시작/종료
- TC-DEV-006: 장비 삭제

### 3.4 음성인식 시나리오

- TC-ASR-001: 음성인식 세션 시작
- TC-ASR-002: 인식 결과 수신
- TC-ASR-003: 세션 종료
- TC-ASR-004: 응급 상황 감지

---

## 4. 기술 부채

| 항목               | 위치                               | 우선순위 | 설명             |
| ------------------ | ---------------------------------- | -------- | ---------------- |
| 인증 비활성화      | `dashboard/page.tsx`, `devices.py` | 🔴 높음  | 보안 취약        |
| 더미 사용자        | `dashboard/page.tsx`               | 🔴 높음  | 실제 인증 필요   |
| localStorage 토큰  | `authStore.ts`                     | 🟡 중간  | XSS 취약점       |
| 하드코딩 설정      | `config.h`                         | 🟡 중간  | NVS 이동 필요    |
| 에러 바운더리 없음 | 프론트엔드 전체                    | 🟢 낮음  | UX 개선          |
| 테스트 커버리지    | 전체                               | 🟡 중간  | 테스트 추가 필요 |

---

## 5. 참고 자료

- [ESP-IDF 문서](https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/)
- [FastAPI 문서](https://fastapi.tiangolo.com/)
- [Next.js 문서](https://nextjs.org/docs)
- [Selenium Python 문서](https://selenium-python.readthedocs.io/)

---

_작성일: 2025-01-13_
_작성자: AI 코드 리뷰 도구_
