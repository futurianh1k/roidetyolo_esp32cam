# 다음 작업 계획

**작성일:** 2025-12-10  
**현재 상태:** Phase 2 완료 (코드 품질 개선)  
**다음 단계:** Phase 1 (보안 강화)

---

## 📊 현재 완료 상태

### ✅ Phase 2: 코드 품질 개선 (완료)

- [x] ASR 서버 리팩토링 (모듈 분리)
- [x] 에러 처리 개선 (커스텀 예외 핸들러)
- [x] ASR 결과 전송 개선 (재시도, 큐잉, 메트릭)
- [x] 테스트 코드 작성 (pytest)

---

## 🎯 다음 작업: Phase 1 - 보안 강화

**우선순위:** 🔴 높음 (프로덕션 배포 전 필수)  
**예상 작업 시간:** 20-25시간

### 1-1. 토큰 저장 방식 변경 (4-6시간) 🔴 최우선

**문제점:**

- 현재 프론트엔드에서 토큰을 `localStorage`에 저장
- XSS 공격에 취약
- 보안 가이드라인 1-2 위반

**작업 내용:**

1. 백엔드: HttpOnly + Secure + SameSite 쿠키로 토큰 전달
2. 프론트엔드: localStorage 제거, 쿠키 자동 사용
3. API 클라이언트 수정 (axios 쿠키 설정)

**체크리스트:**

- [ ] 백엔드 로그인 API 쿠키 설정
- [ ] 백엔드 로그아웃 API 쿠키 삭제
- [ ] 프론트엔드 localStorage 제거
- [ ] API 클라이언트 쿠키 설정
- [ ] XSS 공격 테스트

**참고 파일:**

- `backend/app/api/auth.py` - 로그인/로그아웃 API
- `frontend/src/lib/api.ts` - API 클라이언트
- `frontend/src/hooks/useAuth.ts` - 인증 훅

---

### 1-2. 인증 시스템 재활성화 (2-3시간) 🔴 높음

**문제점:**

- 개발 편의를 위해 인증 체크가 주석 처리됨
- 프로덕션 배포 시 보안 위험

**작업 내용:**

1. 백엔드: 모든 TODO 주석 제거, 인증 체크 활성화
2. 프론트엔드: 라우트 가드 미들웨어 추가

**체크리스트:**

- [ ] 백엔드 모든 TODO 주석 제거
  - `backend/app/api/devices.py` (40, 75, 99번 줄)
  - `backend/app/api/control.py` (32, 98, 167, 230번 줄)
  - `backend/app/api/asr.py` (49, 175, 289, 357번 줄)
- [ ] 프론트엔드 로그인 우회 제거
- [ ] 라우트 가드 미들웨어 추가
- [ ] 인증 실패 시 로그인 페이지 리다이렉트
- [ ] 토큰 만료 시 자동 갱신 테스트

**참고 파일:**

- `backend/app/api/devices.py`
- `backend/app/api/control.py`
- `backend/app/api/asr.py`
- `frontend/src/app/page.tsx` (로그인 우회 코드)
- `frontend/src/middleware.ts` (라우트 가드)

---

### 1-3. HTTPS 설정 (2-3시간) 🟡 중간

**작업 내용:**

1. Nginx 리버스 프록시 설정
2. Let's Encrypt SSL 인증서 발급
3. HSTS 헤더 추가

**체크리스트:**

- [ ] 도메인 설정
- [ ] Let's Encrypt 인증서 발급
- [ ] Nginx 설정 파일 작성
- [ ] HTTPS 연결 테스트
- [ ] SSL Labs 테스트 (A+ 등급 목표)

**참고:**

- 개발 환경에서는 선택 사항
- 프로덕션 배포 시 필수

---

### 1-4. 감사 로그 완성 (2시간) 🟡 중간

**문제점:**

- 일부 API에서 감사 로그가 TODO로 비활성화됨
- ISMS-P 요구사항 미충족

**작업 내용:**

1. 모든 TODO 주석 제거
2. 감사 로그 기록 활성화
3. 감사 로그 조회 API 추가

**체크리스트:**

- [ ] 모든 TODO 주석 제거
- [ ] 모든 관리자 액션에 로그 기록
- [ ] 감사 로그 조회 API 추가
- [ ] IP 주소 추적 확인

**참고 파일:**

- `backend/app/services/audit_log.py`
- `backend/app/api/audit.py` (신규 생성 필요)

---

### 1-5. Rate Limiting 구현 (2-3시간) 🟡 중간

**작업 내용:**

1. FastAPI-Limiter 도입
2. Redis 기반 Rate Limiting
3. 로그인 API: 5회/분 제한

**체크리스트:**

- [ ] Redis 설치 및 설정
- [ ] FastAPI-Limiter 통합
- [ ] 로그인 API Rate Limiting (5회/분)
- [ ] 장비 제어 API Rate Limiting (10회/분)

**참고:**

- 개발 환경에서는 선택 사항
- 프로덕션 배포 시 권장

---

## 📅 권장 작업 순서

### Week 1: 보안 강화

**Day 1-2: 토큰 저장 방식 변경**

- 가장 중요한 보안 취약점 해결
- XSS 공격 방어

**Day 3: 인증 시스템 재활성화**

- 프로덕션 배포 전 필수
- 모든 API 보호

**Day 4: HTTPS 설정**

- 프로덕션 환경 준비
- SSL 인증서 발급

**Day 5: 감사 로그 완성 + Rate Limiting**

- ISMS-P 요구사항 충족
- DoS 공격 방어

---

## 🔄 대안: Phase 3 - 기능 확장 (선택 사항)

보안 강화 대신 기능 확장을 먼저 진행할 수도 있습니다:

### 3-1. ASR 결과 저장 (4-6시간)

- 데이터베이스에 ASR 결과 저장
- 결과 조회 API 추가
- 결과 검색 기능

### 3-2. 응급 상황 알림 개선 (3-4시간)

- 알림 우선순위 설정
- 알림 이력 저장
- 알림 설정 UI

### 3-3. 대시보드 개선 (4-6시간)

- ASR 통계 차트
- 응급 상황 이력
- 실시간 모니터링

---

## 💡 추천

**프로덕션 배포를 계획 중이라면:**
→ **Phase 1 (보안 강화)** 우선 진행

**개발/테스트 환경이라면:**
→ **Phase 3 (기능 확장)** 먼저 진행 가능

---

**다음 작업 결정 필요:** Phase 1 또는 Phase 3 중 선택
